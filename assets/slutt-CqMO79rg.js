import{a as P,j as e,r as n,T as M}from"./Toolbar-aR2_oIyz.js";import{s as K}from"./stages-C8iUDG9v.js";import{p as I}from"./participants-hiEC40SX.js";function J({stage:S,selected:D,onSelect:f}){var b;const F=JSON.parse(localStorage.getItem("participantTimes")||"{}"),T=JSON.parse(localStorage.getItem("participantStatus")||"{}"),h=F[S]||{},N=T[S]||{},[O,t]=n.useState(!1),r=I.find(l=>l.id===D);let g="",m="px-4 py-2 rounded cursor-pointer border";return r&&(N[r.id]==="DNS"?(g=" (DNS)",m+=" bg-red-600 text-white font-bold"):N[r.id]==="DNF"?(g=" (DNF)",m+=" bg-red-600 text-white font-bold"):(b=h[r.id])!=null&&b.end&&(g=` ${h[r.id].end}`)),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Etappe: ",S]}),e.jsx("p",{className:"mb-2",children:"Velg deltaker"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:m+" w-full",onClick:()=>t(l=>!l),role:"button",tabIndex:0,style:{outline:"none"},onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&t(o=>!o)},children:r?`#${r.id} - ${r.name}${g}`:"Startnummer eller navn"}),O&&e.jsx("div",{className:"absolute z-50 w-full border rounded-md bg-white shadow-lg mt-2 max-h-96 overflow-y-auto",children:I.map(l=>{var x;let o="",d="cursor-pointer px-4 py-2";return N[l.id]==="DNS"?(o=" (DNS)",d+=" bg-red-600 text-white font-bold"):N[l.id]==="DNF"?(o=" (DNF)",d+=" bg-red-600 text-white font-bold"):(x=h[l.id])!=null&&x.end&&(o=` ${h[l.id].end}`),D===l.id&&(d+=" ring-2 ring-purple-700"),e.jsxs("div",{className:d,onClick:()=>{f(l.id),t(!1)},role:"button",tabIndex:0,style:{outline:"none"},onKeyDown:j=>{(j.key==="Enter"||j.key===" ")&&(f(l.id),t(!1))},children:["#",l.id," - ",l.name,o]},l.id)})})]})]})}function V(){const[S,D]=n.useState(""),[f,F]=n.useState(""),[T,h]=n.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(M,{}),e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 pt-20",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Registrer Sluttid"}),S?f?e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsx(O,{stage:S,participant:f,type:"end"})}):e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsx(J,{stage:S,selected:f,onSelect:F})}):e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsx(N,{onSelect:D})})]})]});function N({onSelect:t}){return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Velg etappe"}),e.jsx("div",{className:"flex flex-col gap-3",children:K.map(r=>e.jsx("button",{onClick:()=>t(r),className:"bg-gray-200 hover:bg-purple-700 hover:text-white py-3 rounded-md font-medium",children:r},r))})]})}function O({stage:t,participant:r,type:g}){const[m,b]=n.useState(""),[l,o]=n.useState(!1),[d,x]=n.useState(""),[j,y]=n.useState(void 0),[s,L]=n.useState(r),[z,C]=n.useState({}),w=n.useCallback(()=>{const a=JSON.parse(localStorage.getItem("participantTimes")||"{}"),i=JSON.parse(localStorage.getItem("participantStatus")||"{}"),c=a[t]||{},v=i[t]||{},u={};I.forEach(p=>{var k;v[p.id]==="DNS"?u[p.id]="DNS":v[p.id]==="DNF"?u[p.id]="DNF":(k=c[p.id])!=null&&k.end?u[p.id]=c[p.id].end:u[p.id]=""}),C(u)},[t]);n.useEffect(()=>{var u;const a=JSON.parse(localStorage.getItem("participantTimes")||"{}"),i=JSON.parse(localStorage.getItem("participantStatus")||"{}"),c=a[t]||{},v=i[t]||{};x(((u=c[s])==null?void 0:u.end)||""),y(v[s]||void 0),o(!1),b(""),w()},[s,t,w]);const R=()=>{let a="";m?a=m:a=new Date().toLocaleTimeString("no-NO",{hour:"2-digit",minute:"2-digit"}),x(a),o(!0),y(void 0);const i=JSON.parse(localStorage.getItem("participantTimes")||"{}");i[t]||(i[t]={}),i[t][s]||(i[t][s]={}),i[t][s].end=a,localStorage.setItem("participantTimes",JSON.stringify(i));const c=JSON.parse(localStorage.getItem("participantStatus")||"{}");c[t]&&c[t][s]&&(delete c[t][s],Object.keys(c[t]).length===0&&delete c[t],localStorage.setItem("participantStatus",JSON.stringify(c))),w()},E=()=>{y("DNS"),x("DNS"),o(!0);const a=JSON.parse(localStorage.getItem("participantStatus")||"{}");a[t]||(a[t]={}),a[t][s]="DNS",localStorage.setItem("participantStatus",JSON.stringify(a));const i=JSON.parse(localStorage.getItem("participantTimes")||"{}");i[t]&&i[t][s]&&(delete i[t][s].end,Object.keys(i[t][s]).length===0&&delete i[t][s],localStorage.setItem("participantTimes",JSON.stringify(i))),w()},$=()=>{y("DNF"),x("DNF"),o(!0);const a=JSON.parse(localStorage.getItem("participantStatus")||"{}");a[t]||(a[t]={}),a[t][s]="DNF",localStorage.setItem("participantStatus",JSON.stringify(a));const i=JSON.parse(localStorage.getItem("participantTimes")||"{}");i[t]&&i[t][s]&&(delete i[t][s].end,Object.keys(i[t][s]).length===0&&delete i[t][s],localStorage.setItem("participantTimes",JSON.stringify(i))),w()};return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx(J,{stage:t,selected:s,onSelect:L})}),e.jsxs("p",{className:"mb-4 text-base sm:text-lg",children:["Deltaker #",s," på etappe ",t]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"manual-time",className:"block mb-1",children:"Manuell tid (hh:mm):"}),e.jsx("input",{id:"manual-time",type:"time",value:m,onChange:a=>b(a.target.value),className:"border px-3 py-3 rounded w-full text-base sm:text-lg"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-2 justify-center mb-4",children:[e.jsx("button",{onClick:R,className:"bg-purple-700 text-white px-6 py-4 rounded-md w-full sm:w-auto text-base sm:text-lg",disabled:!s,children:m?"Registrer manuell tid":"Registrer tid nå"}),e.jsx("button",{onClick:E,className:"bg-yellow-500 text-white px-6 py-4 rounded-md w-full sm:w-auto text-base sm:text-lg",type:"button",disabled:!s,children:"DNS"}),e.jsx("button",{onClick:$,className:"bg-red-600 text-white px-6 py-4 rounded-md w-full sm:w-auto text-base sm:text-lg",type:"button",disabled:!s,children:"DNF"})]}),l&&e.jsxs("div",{className:"p-4 bg-purple-100 border border-purple-400 rounded-md mt-4",children:[d==="DNS"&&e.jsxs(e.Fragment,{children:["DNS registrert for #",s]}),d==="DNF"&&e.jsxs(e.Fragment,{children:["DNF registrert for #",s]}),d!=="DNS"&&d!=="DNF"&&e.jsxs(e.Fragment,{children:["Tid registrert for #",s," kl. ",d]})]}),j&&e.jsxs("div",{className:"mt-2 text-red-600 font-bold",children:["Status: ",j]})]})}}P(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(V,{})}));
