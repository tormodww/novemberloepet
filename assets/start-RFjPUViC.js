import{a as z,j as e,r as o,T as A}from"./Toolbar-B0NiT4Bs.js";import{s as B,g as D,a as g,b as T,c as R}from"./storageApi-BNNNQTAE.js";import{p as E}from"./participants-hiEC40SX.js";function $({stage:b,selected:v,onSelect:S}){var F;const C=D(),P=g(),w=C[b]||{},p=P[b]||{},[L,t]=o.useState(!1),n=E.find(r=>r.id===v);let N="",m="px-4 py-2 rounded cursor-pointer border-2 border-blue-500 bg-white",j={};return n&&(p[n.id]==="DNS"?(N=" (DNS)",m="px-4 py-2 rounded cursor-pointer border-2 border-red-600 font-bold",j={backgroundColor:"#dc2626",color:"#fff",fontWeight:"bold"}):p[n.id]==="DNF"?(N=" (DNF)",m="px-4 py-2 rounded cursor-pointer border-2 border-red-600 font-bold",j={backgroundColor:"#dc2626",color:"#fff",fontWeight:"bold"}):(F=w[n.id])!=null&&F.start?N=` ${w[n.id].start}`:N=""),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-blue-700 bg-blue-100 rounded px-4 py-2 mb-4",children:["Etappe: ",b]}),e.jsx("p",{className:"mb-2",children:"Velg deltaker"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:m+" w-full",onClick:()=>t(r=>!r),role:"button",tabIndex:0,style:{outline:"none",...j},onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&t(c=>!c)},children:n?`#${n.id} - ${n.name}${N}`:"Startnummer eller navn"}),L&&e.jsx("div",{className:"absolute z-50 w-full border-2 border-blue-500 rounded-md bg-blue-50 shadow-2xl mt-2 max-h-96 overflow-y-auto",children:E.map((r,c)=>{var h;let d="",u="cursor-pointer px-4 py-2 hover:bg-blue-100 transition";return u+=c%2===0?" bg-blue-50":" bg-blue-100",p[r.id]==="DNS"?(d=" (DNS)",u+=" bg-red-600 text-white font-bold"):p[r.id]==="DNF"?(d=" (DNF)",u+=" bg-red-600 text-white font-bold"):(h=w[r.id])!=null&&h.start?d=` ${w[r.id].start}`:d="",v===r.id&&(u+=" ring-2 ring-blue-600"),e.jsxs("div",{className:u,onClick:()=>{S(r.id),t(!1)},role:"button",tabIndex:0,style:{outline:"none"},onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&(S(r.id),t(!1))},children:["#",r.id," - ",r.name,d]},r.id)})})]})]})}function q(){const[b,v]=o.useState(""),[S,C]=o.useState(""),[P,w]=o.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(A,{}),e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 pt-20",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Registrer Starttid"}),b?S?e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsx(L,{stage:b,participant:S,type:"start"})}):e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsx($,{stage:b,selected:S,onSelect:C})}):e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsx(p,{onSelect:v})})]})]});function p({onSelect:t}){return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Velg etappe"}),e.jsx("div",{className:"flex flex-col gap-3",children:B.map(n=>e.jsx("button",{onClick:()=>t(n),className:"bg-gray-200 hover:bg-blue-600 hover:text-white py-3 rounded-md font-medium",children:n},n))})]})}function L({stage:t,participant:n,type:N}){const[m,j]=o.useState(""),[F,r]=o.useState(!1),[c,d]=o.useState(""),[u,h]=o.useState(void 0),[s,I]=o.useState(n),[G,M]=o.useState({}),y=o.useCallback(()=>{const l=D(),i=g(),a=l[t]||{},k=i[t]||{},x={};E.forEach(f=>{var O;k[f.id]==="DNS"?x[f.id]="DNS":k[f.id]==="DNF"?x[f.id]="DNF":(O=a[f.id])!=null&&O.start?x[f.id]=a[f.id].start:x[f.id]=""}),M(x)},[t]);o.useEffect(()=>{var x;const l=D(),i=g(),a=l[t]||{},k=i[t]||{};d(((x=a[s])==null?void 0:x.start)||""),h(k[s]||void 0),r(!1),j(""),y()},[s,t,y]);const K=()=>{let l="";m?l=m:l=new Date().toLocaleTimeString("no-NO",{hour:"2-digit",minute:"2-digit"}),d(l),r(!0),h(void 0);const i=D();i[t]||(i[t]={}),i[t][s]||(i[t][s]={}),i[t][s].start=l,T(i);const a=g();a[t]&&a[t][s]&&(delete a[t][s],Object.keys(a[t]).length===0&&delete a[t],R(a)),y()},V=()=>{h("DNS"),d("DNS"),r(!0);const l=g();l[t]||(l[t]={}),l[t][s]="DNS",R(l);const i=D();i[t]&&i[t][s]&&(delete i[t][s].start,Object.keys(i[t][s]).length===0&&delete i[t][s],T(i)),y()},W=()=>{h("DNF"),d("DNF"),r(!0);const l=g();l[t]||(l[t]={}),l[t][s]="DNF",R(l);const i=D();i[t]&&i[t][s]&&(delete i[t][s].start,Object.keys(i[t][s]).length===0&&delete i[t][s],T(i)),y()};return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mb-4",children:e.jsx($,{stage:t,selected:s,onSelect:I})}),e.jsxs("p",{className:"mb-4 text-base sm:text-lg",children:["Deltaker #",s," på etappe ",t]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"manual-time",className:"block mb-1",children:"Manuell tid (hh:mm):"}),e.jsx("input",{id:"manual-time",type:"time",value:m,onChange:l=>j(l.target.value),className:"border px-3 py-3 rounded w-full text-base sm:text-lg"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-2 justify-center mb-4",children:[e.jsx("button",{onClick:K,className:"bg-green-600 text-white px-6 py-4 rounded-md w-full sm:w-auto text-base sm:text-lg",disabled:!s,children:m?"Registrer manuell tid":"Registrer tid nå"}),e.jsx("button",{onClick:V,className:"bg-yellow-500 text-white px-6 py-4 rounded-md w-full sm:w-auto text-base sm:text-lg",type:"button",disabled:!s,children:"DNS"}),e.jsx("button",{onClick:W,className:"bg-red-600 text-white px-6 py-4 rounded-md w-full sm:w-auto text-base sm:text-lg",type:"button",disabled:!s,children:"DNF"})]}),F&&e.jsxs("div",{className:"p-4 bg-green-100 border border-green-400 rounded-md mt-4",children:[c==="DNS"&&e.jsxs(e.Fragment,{children:["DNS registrert for #",s]}),c==="DNF"&&e.jsxs(e.Fragment,{children:["DNF registrert for #",s]}),c!=="DNS"&&c!=="DNF"&&e.jsxs(e.Fragment,{children:["Tid registrert for #",s," kl. ",c]})]}),u&&e.jsxs("div",{className:"mt-2 text-red-600 font-bold",children:["Status: ",u]})]})}}z(document.getElementById("root")).render(e.jsx(o.StrictMode,{children:e.jsx(q,{})}));
