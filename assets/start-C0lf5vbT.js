import{a as P,j as t,r as n,T as M}from"./Toolbar-aR2_oIyz.js";import{s as V}from"./stages-C8iUDG9v.js";import{p as I}from"./participants-hiEC40SX.js";function J({stage:p,selected:D,onSelect:f}){var h;const F=JSON.parse(localStorage.getItem("participantTimes")||"{}"),k=JSON.parse(localStorage.getItem("participantStatus")||"{}"),b=F[p]||{},N=k[p]||{},[O,e]=n.useState(!1),l=I.find(r=>r.id===D);let g="",m="px-4 py-2 rounded cursor-pointer border";return l&&(N[l.id]==="DNS"?(g=" (DNS)",m+=" bg-red-600 text-white font-bold"):N[l.id]==="DNF"?(g=" (DNF)",m+=" bg-red-600 text-white font-bold"):(h=b[l.id])!=null&&h.start&&(g=` ${b[l.id].start}`)),t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Etappe: ",p]}),t.jsx("p",{className:"mb-2",children:"Velg deltaker"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:m+" w-full",onClick:()=>e(r=>!r),role:"button",tabIndex:0,style:{outline:"none"},onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&e(o=>!o)},children:l?`#${l.id} - ${l.name}${g}`:"Startnummer eller navn"}),O&&t.jsx("div",{className:"absolute z-50 w-full border rounded-md bg-white shadow-lg mt-2 max-h-96 overflow-y-auto",children:I.map(r=>{var x;let o="",d="cursor-pointer px-4 py-2";return N[r.id]==="DNS"?(o=" (DNS)",d+=" bg-red-600 text-white font-bold"):N[r.id]==="DNF"?(o=" (DNF)",d+=" bg-red-600 text-white font-bold"):(x=b[r.id])!=null&&x.start&&(o=` ${b[r.id].start}`),D===r.id&&(d+=" ring-2 ring-blue-600"),t.jsxs("div",{className:d,onClick:()=>{f(r.id),e(!1)},role:"button",tabIndex:0,style:{outline:"none"},onKeyDown:j=>{(j.key==="Enter"||j.key===" ")&&(f(r.id),e(!1))},children:["#",r.id," - ",r.name,o]},r.id)})})]})]})}function K(){const[p,D]=n.useState(""),[f,F]=n.useState(""),[k,b]=n.useState(!1);return t.jsxs(t.Fragment,{children:[t.jsx(M,{}),t.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 pt-20",children:[t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Registrer Starttid"}),p?f?t.jsx("div",{className:"w-full max-w-md mx-auto",children:t.jsx(O,{stage:p,participant:f,type:"start"})}):t.jsx("div",{className:"w-full max-w-md mx-auto",children:t.jsx(J,{stage:p,selected:f,onSelect:F})}):t.jsx("div",{className:"w-full max-w-md mx-auto",children:t.jsx(N,{onSelect:D})})]})]});function N({onSelect:e}){return t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Velg etappe"}),t.jsx("div",{className:"flex flex-col gap-3",children:V.map(l=>t.jsx("button",{onClick:()=>e(l),className:"bg-gray-200 hover:bg-blue-600 hover:text-white py-3 rounded-md font-medium",children:l},l))})]})}function O({stage:e,participant:l,type:g}){const[m,h]=n.useState(""),[r,o]=n.useState(!1),[d,x]=n.useState(""),[j,y]=n.useState(void 0),[s,L]=n.useState(l),[z,C]=n.useState({}),w=n.useCallback(()=>{const i=JSON.parse(localStorage.getItem("participantTimes")||"{}"),a=JSON.parse(localStorage.getItem("participantStatus")||"{}"),c=i[e]||{},v=a[e]||{},u={};I.forEach(S=>{var T;v[S.id]==="DNS"?u[S.id]="DNS":v[S.id]==="DNF"?u[S.id]="DNF":(T=c[S.id])!=null&&T.start?u[S.id]=c[S.id].start:u[S.id]=""}),C(u)},[e]);n.useEffect(()=>{var u;const i=JSON.parse(localStorage.getItem("participantTimes")||"{}"),a=JSON.parse(localStorage.getItem("participantStatus")||"{}"),c=i[e]||{},v=a[e]||{};x(((u=c[s])==null?void 0:u.start)||""),y(v[s]||void 0),o(!1),h(""),w()},[s,e,w]);const R=()=>{let i="";m?i=m:i=new Date().toLocaleTimeString("no-NO",{hour:"2-digit",minute:"2-digit"}),x(i),o(!0),y(void 0);const a=JSON.parse(localStorage.getItem("participantTimes")||"{}");a[e]||(a[e]={}),a[e][s]||(a[e][s]={}),a[e][s].start=i,localStorage.setItem("participantTimes",JSON.stringify(a));const c=JSON.parse(localStorage.getItem("participantStatus")||"{}");c[e]&&c[e][s]&&(delete c[e][s],Object.keys(c[e]).length===0&&delete c[e],localStorage.setItem("participantStatus",JSON.stringify(c))),w()},E=()=>{y("DNS"),x("DNS"),o(!0);const i=JSON.parse(localStorage.getItem("participantStatus")||"{}");i[e]||(i[e]={}),i[e][s]="DNS",localStorage.setItem("participantStatus",JSON.stringify(i));const a=JSON.parse(localStorage.getItem("participantTimes")||"{}");a[e]&&a[e][s]&&(delete a[e][s].start,Object.keys(a[e][s]).length===0&&delete a[e][s],localStorage.setItem("participantTimes",JSON.stringify(a))),w()},$=()=>{y("DNF"),x("DNF"),o(!0);const i=JSON.parse(localStorage.getItem("participantStatus")||"{}");i[e]||(i[e]={}),i[e][s]="DNF",localStorage.setItem("participantStatus",JSON.stringify(i));const a=JSON.parse(localStorage.getItem("participantTimes")||"{}");a[e]&&a[e][s]&&(delete a[e][s].start,Object.keys(a[e][s]).length===0&&delete a[e][s],localStorage.setItem("participantTimes",JSON.stringify(a))),w()};return t.jsxs("div",{className:"text-center",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block mb-1 font-semibold",children:"Velg deltaker:"}),t.jsx(J,{stage:e,selected:s,onSelect:L})]}),t.jsxs("p",{className:"mb-4 text-base sm:text-lg",children:["Deltaker #",s," på etappe ",e]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"manual-time",className:"block mb-1",children:"Manuell tid (hh:mm):"}),t.jsx("input",{id:"manual-time",type:"time",value:m,onChange:i=>h(i.target.value),className:"border px-3 py-3 rounded w-full text-base sm:text-lg"})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-2 justify-center mb-4",children:[t.jsx("button",{onClick:R,className:"bg-green-600 text-white px-6 py-4 rounded-md w-full sm:w-auto text-base sm:text-lg",disabled:!s,children:m?"Registrer manuell tid":"Registrer tid nå"}),t.jsx("button",{onClick:E,className:"bg-yellow-500 text-white px-6 py-4 rounded-md w-full sm:w-auto text-base sm:text-lg",type:"button",disabled:!s,children:"DNS"}),t.jsx("button",{onClick:$,className:"bg-red-600 text-white px-6 py-4 rounded-md w-full sm:w-auto text-base sm:text-lg",type:"button",disabled:!s,children:"DNF"})]}),r&&t.jsxs("div",{className:"p-4 bg-green-100 border border-green-400 rounded-md mt-4",children:[d==="DNS"&&t.jsxs(t.Fragment,{children:["DNS registrert for #",s]}),d==="DNF"&&t.jsxs(t.Fragment,{children:["DNF registrert for #",s]}),d!=="DNS"&&d!=="DNF"&&t.jsxs(t.Fragment,{children:["Tid registrert for #",s," kl. ",d]})]}),j&&t.jsxs("div",{className:"mt-2 text-red-600 font-bold",children:["Status: ",j]})]})}}P(document.getElementById("root")).render(t.jsx(n.StrictMode,{children:t.jsx(K,{})}));
