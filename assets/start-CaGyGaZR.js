import{a as P,j as t,r as n,T as M}from"./Toolbar-B1CE5QpT.js";import{s as K}from"./stages-C8iUDG9v.js";import{p as I}from"./participants-hiEC40SX.js";function J({stage:x,selected:y,onSelect:b}){var j;const F=JSON.parse(localStorage.getItem("participantTimes")||"{}"),T=JSON.parse(localStorage.getItem("participantStatus")||"{}"),g=F[x]||{},N=T[x]||{},[O,e]=n.useState(!1),l=I.find(r=>r.id===y);let h="",m="px-4 py-2 rounded cursor-pointer border-2 border-blue-500 bg-white";return l&&(N[l.id]==="DNS"?(h=" (DNS)",m+=" bg-red-600 text-white font-bold"):N[l.id]==="DNF"?(h=" (DNF)",m+=" bg-red-600 text-white font-bold"):(j=g[l.id])!=null&&j.start&&(h=` ${g[l.id].start}`)),t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Etappe: ",x]}),t.jsx("p",{className:"mb-2",children:"Velg deltaker"}),t.jsxs("div",{className:"relative",children:[t.jsx("div",{className:m+" w-full",onClick:()=>e(r=>!r),role:"button",tabIndex:0,style:{outline:"none"},onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&e(u=>!u)},children:l?`#${l.id} - ${l.name}${h}`:"Startnummer eller navn"}),O&&t.jsx("div",{className:"absolute z-50 w-full border-2 border-blue-500 rounded-md bg-blue-50 shadow-2xl mt-2 max-h-96 overflow-y-auto",children:I.map((r,u)=>{var w;let c="",d="cursor-pointer px-4 py-2 hover:bg-blue-100 transition";return d+=u%2===0?" bg-blue-50":" bg-blue-100",N[r.id]==="DNS"?(c=" (DNS)",d+=" bg-red-600 text-white font-bold"):N[r.id]==="DNF"?(c=" (DNF)",d+=" bg-red-600 text-white font-bold"):(w=g[r.id])!=null&&w.start&&(c=` ${g[r.id].start}`),y===r.id&&(d+=" ring-2 ring-blue-600"),t.jsxs("div",{className:d,onClick:()=>{b(r.id),e(!1)},role:"button",tabIndex:0,style:{outline:"none"},onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&(b(r.id),e(!1))},children:["#",r.id," - ",r.name,c]},r.id)})})]})]})}function V(){const[x,y]=n.useState(""),[b,F]=n.useState(""),[T,g]=n.useState(!1);return t.jsxs(t.Fragment,{children:[t.jsx(M,{}),t.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center p-4 pt-20",children:[t.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Registrer Starttid"}),x?b?t.jsx("div",{className:"w-full max-w-md mx-auto",children:t.jsx(O,{stage:x,participant:b,type:"start"})}):t.jsx("div",{className:"w-full max-w-md mx-auto",children:t.jsx(J,{stage:x,selected:b,onSelect:F})}):t.jsx("div",{className:"w-full max-w-md mx-auto",children:t.jsx(N,{onSelect:y})})]})]});function N({onSelect:e}){return t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Velg etappe"}),t.jsx("div",{className:"flex flex-col gap-3",children:K.map(l=>t.jsx("button",{onClick:()=>e(l),className:"bg-gray-200 hover:bg-blue-600 hover:text-white py-3 rounded-md font-medium",children:l},l))})]})}function O({stage:e,participant:l,type:h}){const[m,j]=n.useState(""),[r,u]=n.useState(!1),[c,d]=n.useState(""),[w,f]=n.useState(void 0),[s,L]=n.useState(l),[z,C]=n.useState({}),D=n.useCallback(()=>{const i=JSON.parse(localStorage.getItem("participantTimes")||"{}"),a=JSON.parse(localStorage.getItem("participantStatus")||"{}"),o=i[e]||{},v=a[e]||{},S={};I.forEach(p=>{var k;v[p.id]==="DNS"?S[p.id]="DNS":v[p.id]==="DNF"?S[p.id]="DNF":(k=o[p.id])!=null&&k.start?S[p.id]=o[p.id].start:S[p.id]=""}),C(S)},[e]);n.useEffect(()=>{var S;const i=JSON.parse(localStorage.getItem("participantTimes")||"{}"),a=JSON.parse(localStorage.getItem("participantStatus")||"{}"),o=i[e]||{},v=a[e]||{};d(((S=o[s])==null?void 0:S.start)||""),f(v[s]||void 0),u(!1),j(""),D()},[s,e,D]);const R=()=>{let i="";m?i=m:i=new Date().toLocaleTimeString("no-NO",{hour:"2-digit",minute:"2-digit"}),d(i),u(!0),f(void 0);const a=JSON.parse(localStorage.getItem("participantTimes")||"{}");a[e]||(a[e]={}),a[e][s]||(a[e][s]={}),a[e][s].start=i,localStorage.setItem("participantTimes",JSON.stringify(a));const o=JSON.parse(localStorage.getItem("participantStatus")||"{}");o[e]&&o[e][s]&&(delete o[e][s],Object.keys(o[e]).length===0&&delete o[e],localStorage.setItem("participantStatus",JSON.stringify(o))),D()},E=()=>{f("DNS"),d("DNS"),u(!0);const i=JSON.parse(localStorage.getItem("participantStatus")||"{}");i[e]||(i[e]={}),i[e][s]="DNS",localStorage.setItem("participantStatus",JSON.stringify(i));const a=JSON.parse(localStorage.getItem("participantTimes")||"{}");a[e]&&a[e][s]&&(delete a[e][s].start,Object.keys(a[e][s]).length===0&&delete a[e][s],localStorage.setItem("participantTimes",JSON.stringify(a))),D()},$=()=>{f("DNF"),d("DNF"),u(!0);const i=JSON.parse(localStorage.getItem("participantStatus")||"{}");i[e]||(i[e]={}),i[e][s]="DNF",localStorage.setItem("participantStatus",JSON.stringify(i));const a=JSON.parse(localStorage.getItem("participantTimes")||"{}");a[e]&&a[e][s]&&(delete a[e][s].start,Object.keys(a[e][s]).length===0&&delete a[e][s],localStorage.setItem("participantTimes",JSON.stringify(a))),D()};return t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"mb-4",children:t.jsx(J,{stage:e,selected:s,onSelect:L})}),t.jsxs("p",{className:"mb-4 text-base sm:text-lg",children:["Deltaker #",s," på etappe ",e]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"manual-time",className:"block mb-1",children:"Manuell tid (hh:mm):"}),t.jsx("input",{id:"manual-time",type:"time",value:m,onChange:i=>j(i.target.value),className:"border px-3 py-3 rounded w-full text-base sm:text-lg"})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row flex-wrap gap-2 justify-center mb-4",children:[t.jsx("button",{onClick:R,className:"bg-green-600 text-white px-6 py-4 rounded-md w-full sm:w-auto text-base sm:text-lg",disabled:!s,children:m?"Registrer manuell tid":"Registrer tid nå"}),t.jsx("button",{onClick:E,className:"bg-yellow-500 text-white px-6 py-4 rounded-md w-full sm:w-auto text-base sm:text-lg",type:"button",disabled:!s,children:"DNS"}),t.jsx("button",{onClick:$,className:"bg-red-600 text-white px-6 py-4 rounded-md w-full sm:w-auto text-base sm:text-lg",type:"button",disabled:!s,children:"DNF"})]}),r&&t.jsxs("div",{className:"p-4 bg-green-100 border border-green-400 rounded-md mt-4",children:[c==="DNS"&&t.jsxs(t.Fragment,{children:["DNS registrert for #",s]}),c==="DNF"&&t.jsxs(t.Fragment,{children:["DNF registrert for #",s]}),c!=="DNS"&&c!=="DNF"&&t.jsxs(t.Fragment,{children:["Tid registrert for #",s," kl. ",c]})]}),w&&t.jsxs("div",{className:"mt-2 text-red-600 font-bold",children:["Status: ",w]})]})}}P(document.getElementById("root")).render(t.jsx(n.StrictMode,{children:t.jsx(V,{})}));
